# ☁️ AWS 네트워크·보안 TIL

> 생성 절차(클릭 튜토리얼)는 생략하고 **개념·설계 의사결정·보안 포인트** 중심으로 정리  
> VPC → IAM/SG → Route 53 → EC2 & Elastic IP

---

## 1) VPC (Virtual Private Cloud)

### 1-1. 왜 필요한가 
- 퍼블릭 클라우드에서는 여러 고객이 물리 인프라를 **공유**. 각 고객 워크로드를 **논리적으로 격리**해야 한다.
- **보안 경계**(서브넷/SG/NACL)와 **트래픽 경로 통제**(라우팅/IGW/NAT)가 가능해야 한다.
- 사내망(온프레미스)·다른 VPC와 **하이브리드/멀티 계층 통신**을 안전하게 연결해야 한다.

### 1-2. 무엇인가 
- 계정/리전 내에 만드는 **사용자 전용 가상 네트워크**  
  - **IP 대역(CIDR)** 지정 → **서브넷**(공개/비공개) 분할  
  - **라우팅 테이블**로 경로 결정  
  - **IGW/NAT GW** 로 인터넷 연결/차단  
  - **보안 그룹/네트워크 ACL** 로 L3/L4 트래픽 제어  
  - **VPC Endpoint(Interface/Gateway)** 로 AWS 서비스에 **인터넷 없이** 사설로 접근

### 1-3. 어떻게 설계하나 
- **CIDR**
  - VPC: 예) `10.0.0.0/16` (확장 여지)  
  - Subnet: 예) `/24` 단위로 AZ별 **퍼블릭/프라이빗** 쌍 분리
- **서브넷 역할 분리**
  - **Public Subnet**: IGW 경로 보유
  - **Private Subnet**: IGW 경로 없음. 앱/DB/내부 서비스
- **보안 경계**
  - **보안 그룹**: 인스턴스 단위, **stateful**, 허용 규칙만 명시
  - **네트워크 ACL**: 서브넷 단위, **stateless**, **허용/거부** 모두 가능(양방향 규칙 필요)

### 1-4. 장점
- **보안성**: 네트워크 계층에서 선제적 차단(기본 비공개 → 필요한 경로만 개방)
- **확장성**: 서브넷/라웃팅/엔드포인트/게이트웨이를 조합해 단계적으로 확장
- **통제력**: IP·경로·방화벽·서비스 경로까지 **내가 설계**

---

## 2) IAM (Identity & Access Management)

### 2-1. 왜 필요한가
- 클라우드는 API 한 줄로 인프라 변경 가능 → **사람/서비스 권한을 정밀 제어**해야 사고·오남용 방지

### 2-2. 핵심 개념
- **User / Group / Role / Policy(JSON)**  
- **Least Privilege**(최소권한), **Separation of Duties**(업무분리), **권한의 위임(AssumeRole)**  
- **권한 스코프**: 서비스/리소스/액션/Condition(태그·IP·시간 등)

---

## 3) Security Group (SG)

### 3-1. 왜 필요한가 & 무엇인가
- 인스턴스/NIC 단위 **stateful** 가상 방화벽. **허용 규칙만** 정의  
- **응답 트래픽 자동 허용** → 운영 단순화. 보안 경계는 **SG를 기본**으로 설계

### 3-2. 어떻게 설계하나
- **포트 최소화**: 80/443 공개, 22는 **회사 고정IP/VPN** 만. DB 포트는 **앱 SG만** 허용
- **SG 간 참조**: “ALB-SG → APP-SG → DB-SG” 식으로 **관계형 허용**
- **환경 분리**: dev/stage/prod SG 분리, 규칙·태그로 가시성 유지

### 3-3. NACL과 비교
| 항목 | SG | NACL |
|---|---|---|
| 범위 | 인스턴스 | 서브넷 |
| 상태성 | Stateful | Stateless |
| 규칙 유형 | Allow only | Allow/Deny |
| 응답 트래픽 | 자동 허용 | 별도 규칙 필요 |
| 용도 | 기본 방화벽 | 대역 차단·세그먼트 정책 |

---

## 4) Route 53 (간단 요약)

### 4-1. 한 줄 정의
- AWS의 **관리형 DNS** + **지능형 라우팅**(지연시간/가중치/장애조치/지리) + **헬스체크**.

### 4-2. 왜 쓰나
- 전세계 **저지연** DNS, **SLA**와 **통합성**
- **Alias** 레코드로 AWS 리소스에 직접 매핑(비용·성능·운영 단순화)

### 4-3. 어디가 포인트인가
- **Private Hosted Zone** 으로 **VPC 내부 DNS** 를 분리(서비스 명으로 내부 통신)  
- **Failover/Latency/Weighted/Geo** 정책으로 **트래픽 제어와 고가용성**

---

## 5) EC2 & Elastic IP

### 5-1. EC2 
- **온디맨드 가상 서버**. 다양한 인스턴스 패밀리(CPU/GPU/메모리/스토리지 최적화)
- **스케일·자동화**(ASG, Launch Template), **이미지 표준화**(AMI)

### 5-2. 네트워킹 상식
- **Public IP**: IGW 경로 + 퍼블릭 IP/Elastic IP 가 있어야 인바운드 가능
- **Private IP**: 사설 통신. 인터넷 아웃바운드 필요 시 **NAT GW**
- **중지/시작 시 Public IP 변경**(탄력적 IP는 유지)

### 5-3. Elastic IP (EIP)
- **고정 퍼블릭 IPv4**. 인스턴스 재기동/교체 시에도 IP 고정으로 **DNS/연결 안정성** 확보
- 단, 공인 IPv4는 **희소·유료** → **필요 최소** 사용 권장
  - **대안**: 도메인은 **ALB/CloudFront** 로 노출, **백엔드는 Private** 로 두고 내부 라우팅
  - 내부에서 S3 등 접근은 **VPC Endpoint** 로 **인터넷 미경유**

---

## 6) 간단 정리

- **VPC**: “인터넷 앞에서도 내부망처럼 설계·운영할 자유”
- **IAM**: “권한은 ‘필요한 만큼만’—규모가 커질수록 조용히 지켜주는 안전벨트”
- **Security Group**: “허용만 적자—관계형 허용으로 구조를 드러내자”
- **Route 53**: “DNS도 인프라다—지능형 라우팅과 사설 DNS를 습관처럼”
- **EC2 & Elastic IP**: “공인 IPv4는 비싼 현찰—ALB/Endpoint로 인터넷을 줄여라”

---

# 🔐 TIL — JWT 토큰 탈취 상황에서의 보안 강화 전략

> **주제:** Access Token / Refresh Token 구조에서 탈취 상황을 가정했을 때의 대응 및 만료 전략

---

## JWT의 특성

- 서버에 세션 정보를 저장하지 않는 **Stateless 구조**
- 클라이언트가 가진 **토큰 자체로 인증이 이뤄짐**
- 따라서 한 번 **탈취되면 임의로 무효화하기 어렵다**

즉, **JWT의 장점(무상태성)** 이 동시에 **보안의 약점**이 되기도 한다.

---

## 탈취 상황 가정

공격자가 사용자의 `AccessToken` 또는 `RefreshToken`을 탈취했다고 가정한다면?

- **AccessToken 유출:** 짧은 시간 동안 API 접근 가능  
- **RefreshToken 유출:** 장기적으로 새로운 AccessToken을 계속 재발급받을 수 있음  

→ 따라서 “토큰의 수명”과 “무효화 방식”을 설계하는 것이 핵심이다.

---

## 보안 강화 전략

### 1️⃣ Access Token 짧은 만료 시간 + Refresh Token 갱신 구조

**핵심 아이디어:**  
AccessToken의 유효기간을 짧게(5~15분) 설정해 **피해 시간 최소화**,  
RefreshToken으로 갱신해 **UX 유지**

**장점**
- 탈취돼도 만료되면 자동 무력화
- 서버 부하 적음, stateless 구조 유지

**단점**
- UX 불편 (갱신 요청 필요)
- RefreshToken 탈취 시 장기 위험 존재

---

### 2️⃣ Refresh Token 화이트리스트 (Allow-list)

**핵심 아이디어:**  
“허용된 RefreshToken만 유효”하도록 서버 측에 목록을 저장  

**작동 방식**
1. 로그인 시 RefreshToken을 **DB/Redis에 등록**
2. 갱신 요청 시 토큰 검증 + 화이트리스트 조회
3. 로그아웃/비밀번호 변경 시 해당 토큰 `REVOKED` 처리

**효과**
- 탈취된 RT가 있어도 화이트리스트에 없는 경우 재발급 불가  
- 장치 단위·세션 단위로 제어 가능

---

### 3️⃣ Access Token 블랙리스트 (Deny-list)

**핵심 아이디어:**  
“차단할 토큰만 기록”해 즉시 폐기 가능하도록 하는 전략  

**활용 상황**
- 로그아웃, 탈취 탐지, 의심 로그인 등에서 **만료 전 차단**  
- Redis에 `jti`(JWT ID)와 함께 TTL=만료시간으로 저장

**효과**
- 토큰 만료 전에도 즉시 무효화 가능  
- RefreshToken 화이트리스트와 함께 사용 시 완전한 대응 가능

---

### 4️⃣ Refresh Token Rotation (RTR)

**핵심 아이디어:**  
RefreshToken을 한 번 쓰면 바로 폐기 → **1회성 토큰**으로 사용

**장점**
- 탈취된 RT 재사용 즉시 탐지 및 차단  
- 높은 보안 요구 환경(금융/의료 등)에 적합

**단점**
- 매 요청마다 RT 재발급·저장 → DB/Redis 부하 증가  
- 사실상 세션 방식에 가까워짐 (stateless 이점 손실)

---

## 전략 선택

| 구분 | 목적 | 적용 여부 |
|------|------|-----------|
| AccessToken 단기 만료 | 기본 보안 수단 | 필수 |
| RefreshToken 화이트리스트 | 장기 권한 제어 | 필수 |
| AccessToken 블랙리스트 | 즉시 폐기 | 선택 |
| RefreshToken Rotation | 고보안 환경용 | 선택 |

---

## 정리

JWT는 **확장성과 무상태성**이 장점이지만,  
**토큰 탈취 시 즉시 무효화가 어렵다**는 치명적 약점을 가진다.

따라서 현실적인 대응책은 다음과 같다:

> **짧은 AccessToken + 화이트리스트 기반 RefreshToken 관리**  
> → 여기에 필요 시 **블랙리스트** 또는 **Rotation**으로 보안 단계 강화

# Filter & Interceptor in Spring
ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê³µí†µì ì¸ ë³´ì•ˆ, ë¡œê¹…, ì¸ì¦ ë“±ì˜ ê¸°ëŠ¥ì€ **ëª¨ë“  ìš”ì²­(Request)** ì— ê³µí†µì ìœ¼ë¡œ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.  
ì´ë¥¼ ìœ„í•´ ìë°” í‘œì¤€ì—ì„œëŠ” **Filter**, ìŠ¤í”„ë§ MVCì—ì„œëŠ” **Interceptor**ë¥¼ ì œê³µí•œë‹¤.

---

## 1ï¸âƒ£ Filter (ì„œë¸”ë¦¿ ê¸°ë°˜ ìˆ˜ë¬¸ì¥)

### ê°œë…
`Filter`ëŠ” **ì„œë¸”ë¦¿(Controller ì§„ì… ì „)** ì—ì„œ ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ë¡œì±„ ê³µí†µ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.  
ì¦‰, ëª¨ë“  ìš”ì²­ì„ **WAS ë‹¨ê³„ì—ì„œ ì „ì—­ì ìœ¼ë¡œ ì œì–´**í•  ìˆ˜ ìˆë‹¤.

---

### í•„í„°ì˜ íë¦„

> HTTP Request â†’ WAS â†’ **Filter** â†’ Servlet â†’ Controller

---

### ì œí•œ ì˜ˆì‹œ

```text
HTTP Request â†’ WAS â†’ Filter â†’ Servlet â†’ Controller (ë¡œê·¸ì¸ ì‚¬ìš©ì)  
HTTP Request â†’ WAS â†’ Filter (ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ â†’ ì„œë¸”ë¦¿ í˜¸ì¶œX - ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì)
```

---

### ğŸ”— í•„í„° ì²´ì¸ ë™ì‘
ì—¬ëŸ¬ ê°œì˜ í•„í„°ë¥¼ ë“±ë¡í•˜ë©´ ìˆœì°¨ì ìœ¼ë¡œ ì²´ì¸ í˜•íƒœë¡œ í˜¸ì¶œëœë‹¤.

> HTTP Request â†’ WAS â†’ Filter1 â†’ Filter2 â†’ Filter3 â†’ Servlet â†’ Controller

---

### Filter ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°
```java
public interface Filter {
    default void init(FilterConfig filterConfig) throws ServletException {}
    
    void doFilter(ServletRequest request,
                  ServletResponse response,
                  FilterChain chain
                 ) throws IOException, ServletException;

    default void destroy() {}
}
```
- `init()` : í•„í„° ì´ˆê¸°í™” (ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ 1íšŒ í˜¸ì¶œ)
- `doFilter()` : ìš”ì²­ë§ˆë‹¤ í˜¸ì¶œ, ì£¼ ë¡œì§ ë‹´ë‹¹
- `destroy()` : ì¢…ë£Œ ì‹œ 1íšŒ í˜¸ì¶œ

--- 

### ì£¼ìš” ìš©ë„
- ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- ì¸ì½”ë”© ì„¤ì •
- CORS ì²˜ë¦¬
- ì¸ì¦/ì¸ê°€, XSS í•„í„°ë§
- ì „ì—­ ê³µí†µ ì •ì±… (ëª¨ë“  URL ê³µí†µ ë¡œì§)

### Spring Bootì—ì„œì˜ ì‚¬ìš©
ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œëŠ” `FilterRegistrationBean`ìœ¼ë¡œ í•„í„°ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.
```java
@Bean
public FilterRegistrationBean<CustomFilter> loggingFilter() {
    FilterRegistrationBean<CustomFilter> registrationBean = new FilterRegistrationBean<>();
    registrationBean.setFilter(new CustomFilter());
    registrationBean.addUrlPatterns("/*");
    return registrationBean;
}
```

> ğŸ”¸ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” `DelegatingFilterProxy`ë¥¼ í†µí•´ Spring Security ê°™ì€ í•„í„°ë¥¼ ìë™ ë“±ë¡í•œë‹¤.  
> ğŸ”¸ í•„í„° ìì²´ëŠ” ìŠ¤í”„ë§ ë¹ˆê³¼ ë¬´ê´€í•œ ì„œë¸”ë¦¿ í‘œì¤€ ì»´í¬ë„ŒíŠ¸ì´ë¯€ë¡œ, ì˜ì¡´ì„± ì£¼ì…(DI)ì´ ì§ì ‘ ë˜ì§€ ì•ŠëŠ”ë‹¤.

---

<br/>

## 2ï¸âƒ£ Interceptor (ìŠ¤í”„ë§ MVC ìˆ˜ë¬¸ì¥)

### ê°œë…
`Interceptor`ëŠ” ìŠ¤í”„ë§ MVCì˜ `DispatcherServlet` ì´í›„ì— ë™ì‘í•˜ë©°,  
ì»¨íŠ¸ë¡¤ëŸ¬ ì ‘ê·¼ ì „í›„ ë° ë·° ë Œë”ë§ ì´í›„ê¹Œì§€ ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆë‹¤.

---

### ì¸í„°ì…‰í„°ì˜ íë¦„

> HTTP Request â†’ WAS â†’ Filter â†’ Servlet â†’ Spring Interceptor â†’ Controller

---

### ì œí•œ ì˜ˆì‹œ
```text
HTTP Request â†’ WAS â†’ Filter â†’ Servlet â†’ Spring Interceptor â†’ Controller (ë¡œê·¸ì¸ ì‚¬ìš©ì)  
HTTP Request â†’ WAS â†’ Filter â†’ Servlet â†’ Spring Interceptor (ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ â†’ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œX - ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì)
```

---

### ğŸ”— ì¸í„°ì…‰í„° ì²´ì¸
> HTTP ìš”ì²­ â†’ WAS â†’ Filter â†’ Servlet â†’ Interceptor1 â†’ Interceptor2 â†’ Controller

---

### `HandlerInterceptor` ì¸í„°í˜ì´ìŠ¤
```java
public interface HandlerInterceptor {
    default boolean preHandle(HttpServletRequest request,
                              HttpServletResponse response,
                              Object handler) throws Exception {
        return true;
    }

    default void postHandle(HttpServletRequest request,
                            HttpServletResponse response,
                            Object handler,
                            @Nullable ModelAndView modelAndView) throws Exception {}

    default void afterCompletion(HttpServletRequest request,
                                 HttpServletResponse response,
                                 Object handler,
                                 @Nullable Exception ex) throws Exception {}
}
```
- `preHandle()` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ (false ë°˜í™˜ ì‹œ ìš”ì²­ ì¤‘ë‹¨)
- `postHandle()` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ í›„, ë·° ë Œë”ë§ ì „
- `afterCompletion()` : ë·° ë Œë”ë§ í›„ (ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ í˜¸ì¶œ)

---

### ì£¼ìš” ìš©ë„
- ë¡œê·¸ì¸/ê¶Œí•œ ê²€ì¦ (JWT, ì„¸ì…˜ ë“±)
- ì»¨íŠ¸ë¡¤ëŸ¬ ê³µí†µ ì²˜ë¦¬ (ë¡œê·¸ ì¶”ì , ì‘ë‹µ ê°€ê³µ)
- API ìš”ì²­ ì‹œê°„ ì¸¡ì •

### ë“±ë¡ ë°©ë²•
`WebMvcConfigurer`ë¥¼ êµ¬í˜„í•˜ì—¬ URL íŒ¨í„´ë³„ë¡œ ì„¸ë°€íˆ ì œì–´ ê°€ëŠ¥í•˜ë‹¤.
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new AuthInterceptor())
                .addPathPatterns("/api/**")
                .excludePathPatterns("/api/login", "/api/signup");
    }
}
```

---

<br/>

## 3ï¸âƒ£ Filter vs Interceptor vs AOP
| êµ¬ë¶„          | Filter                              | Interceptor                 | AOP                  |
| ----------- | ----------------------------------- | --------------------------- | -------------------- |
| ë™ì‘ ì‹œì        | WAS ë‹¨ê³„ (ì„œë¸”ë¦¿ ì „)                      | ìŠ¤í”„ë§ MVC ë‹¨ê³„ (Controller ì „/í›„) | ìŠ¤í”„ë§ ë¹ˆ ë©”ì„œë“œ í˜¸ì¶œ ì‹œ       |
| ê¸°ë°˜ ê¸°ìˆ        | Servlet API                         | Spring MVC                  | Spring AOP (í”„ë¡ì‹œ ê¸°ë°˜)  |
| ë“±ë¡ ìœ„ì¹˜       | `web.xml`, `FilterRegistrationBean` | `WebMvcConfigurer`          | `@Aspect`, `@Around` |
| ì ìš© ëŒ€ìƒ       | ëª¨ë“  ìš”ì²­ (ì •ì  ë¦¬ì†ŒìŠ¤ í¬í•¨)                   | ìŠ¤í”„ë§ ì»¨íŠ¸ë¡¤ëŸ¬ í•¸ë“¤ëŸ¬                | ìŠ¤í”„ë§ ë¹ˆì˜ ë©”ì„œë“œ            |
| DI ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ | âŒ (ìŠ¤í”„ë§ ë¹ˆ ì•„ë‹˜)                        | âœ… (ìŠ¤í”„ë§ ë¹ˆ)                   | âœ… (ìŠ¤í”„ë§ ë¹ˆ)            |
| ëŒ€í‘œ ì‚¬ìš© ì˜ˆì‹œ    | ì¸ì½”ë”©, CORS, XSS, ë¡œê¹… , ì¸ì¦/ì¸ê°€                 | ì¸ì¦/ì¸ê°€, ìš”ì²­ ê²€ì¦                | íŠ¸ëœì­ì…˜, ì˜ˆì™¸ì²˜ë¦¬       |

---

## âœ… ë§ˆë¬´ë¦¬ ì •ë¦¬
- `Filter` : WAS ë ˆë²¨ì˜ ìš”ì²­ ì „ì²˜ë¦¬ (ìŠ¤í”„ë§ ë…ë¦½)
- `Interceptor` : MVC ìš”ì²­ ì œì–´ (ìŠ¤í”„ë§ ì˜ì¡´)
- `AOP` : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³µí†µê´€ì‹¬ì‚¬ (íŠ¸ëœì­ì…˜, ë¡œê¹… ë“±)

### ê²°ë¡ :
- ì •ë‹µì€ ì—†ë‹¤.
- ì‹œìŠ¤í…œ êµ¬ì¡°ì— ë”°ë¼ í•„í„° + ì¸í„°ì…‰í„°ë¥¼ ë³‘í–‰í•˜ê±°ë‚˜, Spring Securityì˜ FilterChainProxy ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•˜ê¸°ë„ í•œë‹¤.
- ë‹¤ë§Œ "ì „ì—­ ì²˜ë¦¬ = Filter", "ë¹„ì¦ˆë‹ˆìŠ¤ ìš”ì²­ ë‹¨ìœ„ ì²˜ë¦¬ = Interceptor" ê°€ ì¼ë°˜ì ì´ë‹¤.

# TIL : Thymeleaf 기본 구조와 문법
> 오늘은 Thymeleaf에 대해 학습한 내용을 간단히 정리해보겠습니다.

--- 

## 📌 Thymeleaf란?

Thymeleaf는 **서버 사이드 Java 템플릿 엔진**으로,  
HTML 파일에 특별한 속성을 추가해 동적인 웹 페이지를 생성할 수 있다.  

Spring Boot에서 **기본적으로 권장하는 뷰 템플릿 엔진**이며,  
**Natural Template 방식**을 지원하여 서버 없이도 브라우저에서 HTML을 직접 확인할 수 있다는 장점이 있다.

### 주요 특징
- **Natural Templates** : 순수 HTML 구조 유지로 디자이너와 개발자 간 협업 용이  
- **Spring 통합** : Spring MVC와 자연스러운 연동  
- **다양한 표현식 지원** : 변수, 메시지, 링크, 조건 등

<br/>
  
--- 

## 🔄 Thymeleaf 동작 구조

<img width="600" height="400" alt="image" src="https://github.com/user-attachments/assets/04615d26-cceb-493a-8f86-f20cb6432afc" />

> 이미지 출처: https://gorilla-ohgiraffers.tistory.com/28

### 1️⃣ 요청 (Browser → DispatcherServlet)
사용자가 브라우저에서 URL을 입력하면, HTTP 요청이 스프링의 **DispatcherServlet**으로 전달된다.  
예시: `http://localhost:8080/hello`

### 2️⃣ 핸들러 매핑 (DispatcherServlet → HandlerMapping)
DispatcherServlet은 **HandlerMapping**을 통해 요청을 처리할 적절한 **Controller**를 찾는다.

### 3️⃣ 컨트롤러 실행 (DispatcherServlet → Controller)
선택된 컨트롤러의 메서드가 실행되어 비즈니스 로직을 수행한다.

```java
@Controller
public class HelloController {

    @GetMapping("/hello")
    public String hello(Model model) {
        model.addAttribute("userName", "kim");
        model.addAttribute("age", 20);
        return "hello"; // 뷰 이름 반환
    }
}
```

### 4️⃣ 모델 데이터 준비 (Controller → Model)
컨트롤러는 처리한 데이터를 Model 객체에 담아 뷰로 전달한다.

> 💡 Model은 컨트롤러와 뷰 사이의 데이터 전달용 저장소로  
> 내부적으로 Map<String, Object> 형태로 동작한다.

### 5️⃣ 뷰 이름 반환 (Controller → DispatcherServlet)
컨트롤러는 실제 파일 경로가 아닌 논리적 뷰 이름만 반환한다.
예: `return "hello";` 

### 6️⃣ 뷰 리졸버 실행 (DispatcherServlet → ViewResolver)
DispatcherServlet은 ViewResolver에게 뷰 이름을 전달하고,
ViewResolver는 이를 실제 템플릿 파일 경로로 변환한다.

```java
# application.yml 예시
spring:
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
```
➡️ `"hello"` → 실제 경로 `classpath:/templates/hello.html`

### 7️⃣ 템플릿 처리 (ViewResolver → Thymeleaf Engine)
Thymeleaf 엔진이 템플릿 파일을 읽어 th:* 속성을 해석하고,
Model에 담긴 데이터를 바인딩한다.

```html
<!-- hello.html -->
<p th:text="${userName}">기본 이름</p>
<!-- 결과: <p>kim</p> -->
```

### 8️⃣ HTML 생성 및 응답 (Thymeleaf Engine → Browser)
Thymeleaf가 해석한 HTML이 DispatcherServlet을 거쳐 브라우저로 전송된다.  
브라우저는 받은 HTML을 파싱하여 DOM을 렌더링하고 CSS/JS를 적용해 화면을 표시한다.

<br/>

---

## Spring MVC DispatcherServlet vs Thymeleaf
| 구분        | DispatcherServlet                                 | Thymeleaf                            |
| --------- | ------------------------------------------------- | ------------------------------------ |
| **역할**    | 프론트 컨트롤러로서 모든 HTTP 요청을 받아 적절한 컨트롤러로 분배            | 템플릿 엔진으로서 HTML에 데이터를 바인딩해 최종 HTML 생성 |
| **계층**    | Spring MVC의 핵심 구성 요소 (Servlet 레벨)                 | View 레이어의 템플릿 처리 엔진                  |
| **처리 시점** | 요청의 시작 단계 (요청 라우팅 및 제어)                           | 응답의 마지막 단계 (뷰 렌더링)                   |
| **주요 기능** | HandlerMapping, HandlerAdapter, ViewResolver 등 조율 | `th:*` 문법 해석, 데이터 바인딩, HTML 생성       |

<br/>

---

## Thymeleaf 기본 문법
Thymeleaf는 HTML 태그 안에 `th:*` 속성을 추가하는 방식으로 동작한다.

### 1️⃣ `th:text` — 텍스트 출력 (이스케이핑)
- 서버에서 전달된 값을 안전하게 HTML에 출력한다.  
```html
<p th:text="${userName}">기본 텍스트</p>
➡️ userName = "kim" → <p>kim</p>
```

### 2️⃣ `th:utext` — HTML 출력
- HTML 태그를 그대로 출력한다.
- escape를 처리하지 않는다.
```html
<p th:utext="${message}">기본 텍스트</p>
➡️ message = "<b>강조된 텍스트</b>" → <p><b>강조된 텍스트</b></p> 
```

### 3️⃣ `th:each` — 반복문
- 리스트나 배열 데이터를 순환하면서 반복 출력한다.
```html
<ul>
  <li th:each="item : ${items}" th:text="${item}"></li>
</ul>
➡️ <!-- items = ["Spring", "Thymeleaf", "JPA"] -->
<ul>
  <li>Spring</li>
  <li>Thymeleaf</li>
  <li>JPA</li>
</ul>
```

### 4️⃣ `th:if` / `th:unless` — 조건문
- 조건에 따라 HTML 태그를 보이거나 숨긴다.
```html
<!-- th:if: 조건이 true일 때 렌더링 -->
<p th:if="${age >= 18}">성인입니다.</p>

<!-- th:unless: 조건이 false일 때 렌더링 (th:if의 반대) -->
<p th:unless="${age >= 18}">미성년자입니다.</p>

<!-- 삼항 연산자 사용 -->
<p th:text="${age >= 18} ? '성인' : '미성년자'"></p>
```

### 5️⃣ `th:switch` / `th:case` — 다중 조건
- 여러 조건을 처리할 때 사용한다.
```html
<div th:switch="${role}">
  <p th:case="'admin'">관리자</p>
  <p th:case="'user'">일반 사용자</p>
  <p th:case="*">기본 역할</p>
</div>
```

### 6️⃣ `th:attr` — 속성 동적 설정
- HTML 속성 전체를 동적으로 변경한다.
```html
<input type="text" th:attr="value=${userName}, placeholder=${userPlaceholder}">
➡️ <input type="text" value="kim" placeholder="이름을 입력하세요"> 
```

### 7️⃣ `th:value`, `th:href`, `th:src` — 특정 속성 설정
- 자주 사용하는 속성은 전용 문법 제공한다.
```html
<!-- 입력 필드 값 -->
<input type="text" th:value="${userName}">

<!-- 링크 URL -->
<a th:href="@{/user/{id}(id=${userId})}">사용자 프로필</a>

<!-- 이미지 경로 -->
<img th:src="@{/images/{filename}(filename=${imgName})}" alt="이미지">
```

### 8️⃣ `th:action` — 폼 액션 설정
- 폼이 제출 경로를 동적으로 설정한다.
```html
<form th:action="@{/user/save}" method="post">
  <input type="text" name="username">
  <button type="submit">저장</button>
</form>
```

### 9️⃣ `th:object` / `th:field` — 폼 객체 바인당
- 객체와 폼 필드를 자동으로 매핑한다.
```html
<form th:action="@{/user/save}" th:object="${user}" method="post">
  <input type="text" th:field="*{name}">
  <input type="email" th:field="*{email}">
  <button type="submit">저장</button>
</form>

<!-- th:field는 id, name, value 속성을 자동 생성 -->
```

<br/>

---

## Thymeleaf 표현식
| 표현식      | 설명                                     | 예시                                                               |
| -------- | -------------------------------------- | ---------------------------------------------------------------- |
| `${...}` | 변수 표현식 — 모델에 담긴 데이터 출력                 | `<p th:text="${user.name}">이름</p>`                               |
| `*{...}` | 선택 변수 표현식 — `th:object`에서 선택된 객체 속성 참조 | `<div th:object="${user}"><p th:text="*{age}"></p></div>`                                       |
| `#{...}` | 메시지 표현식 — i18n 국제화 메시지 호출              | `<p th:text="#{welcome.message}"></p>`                           |
| `@{...}` | URL 표현식 — 컨텍스트 경로 포함 동적 링크             | `<a th:href="@{/home}">홈</a>`               |
| `~{...}` | 프래그먼트 표현식 — HTML 조각 재사용                | `<div th:replace="~{fragments/header :: headerFragment}"></div>` |

